!function($){"use strict";var t=function(t){var e=$.Deferred(),n=new FileReader;return n.onload=function(t){e.resolve(t.target.result)},n.onerror=e.reject,n.onprogress=e.notify,n.readAsDataURL(t),e.promise()};$.fn.cleanHtml=function(){var t=$(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},$.fn.wysiwyg=function(e){var n=this,o,a,i,r=function(){a.activeToolbarClass&&$(a.toolbarSelector).find(i).each(function(){var t=$(this).data(a.commandRole);document.queryCommandState(t)?$(this).addClass(a.activeToolbarClass):$(this).removeClass(a.activeToolbarClass)})},l=function(t,e){var n=t.split(" "),o=n.shift(),a=n.join(" ")+(e||"");document.execCommand(o,0,a),r()},s=function(t){$.each(t,function(t,e){n.keydown(t,function(t){n.attr("contenteditable")&&n.is(":visible")&&(t.preventDefault(),t.stopPropagation(),l(e))}).keyup(t,function(t){n.attr("contenteditable")&&n.is(":visible")&&(t.preventDefault(),t.stopPropagation())})})},c=function(){var t=window.getSelection();return t.getRangeAt&&t.rangeCount?t.getRangeAt(0):void 0},d=function(){o=c()},u=function(){var t=window.getSelection();if(o){try{t.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}t.addRange(o)}},f=function(e){n.focus(),$.each(e,function(e,n){/^image\//.test(n.type)?$.when(t(n)).done(function(t){l("insertimage",t)}).fail(function(t){a.fileUploadError("file-reader",t)}):a.fileUploadError("unsupported-file-type",n.type)})},m=function(t,e){u(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,e||"transparent"),d(),t.data(a.selectionMarker,e)},p=function(t,e){t.find(i).click(function(){u(),n.focus(),l($(this).data(e.commandRole)),d()}),t.find("[data-toggle=dropdown]").click(u),t.find("input[type=text][data-"+e.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="",u(),t&&(n.focus(),l($(this).data(e.commandRole),t)),d()}).on("focus",function(){var t=$(this);t.data(e.selectionMarker)||(m(t,e.selectionColor),t.focus())}).on("blur",function(){var t=$(this);t.data(e.selectionMarker)&&m(t,!1)}),t.find("input[type=file][data-"+e.commandRole+"]").change(function(){u(),"file"===this.type&&this.files&&this.files.length>0&&f(this.files),d(),this.value=""})},g=function(){n.on("dragenter dragover",!1).on("drop",function(t){var e=t.originalEvent.dataTransfer;t.stopPropagation(),t.preventDefault(),e&&e.files&&e.files.length>0&&f(e.files)})};return a=$.extend({},$.fn.wysiwyg.defaults,e),i="a[data-"+a.commandRole+"],button[data-"+a.commandRole+"],input[type=button][data-"+a.commandRole+"]",s(a.hotKeys),a.dragAndDropImages&&g(),p($(a.toolbarSelector),a),n.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){d(),r()}),$(window).bind("touchend",function(t){var e=n.is(t.target)||n.has(t.target).length>0,o=c(),a=o&&o.startContainer===o.endContainer&&o.startOffset===o.endOffset;(!a||e)&&(d(),r())}),this},$.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function(t,e){console.log("File upload error",t,e)}},$.initWysiwyg=function(){function t(){var t=["Open Sans","Roboto","Helvetica Neue","Courier New","Lucida Grande","Tahoma","Times New Roman","Verdana"],e=$("[title=Font]").siblings(".dropdown-menu");if($.each(t,function(t,n){e.append($('<li><a data-edit="fontName '+n+'" style="font-family:\''+n+"'\">"+n+"</a></li>"))}),$("a[title]").tooltip({container:"body"}),$(".dropdown-menu input").click(function(){return!1}).change(function(){$(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="",$(this).change()}),$("[data-role=magic-overlay]").each(function(){var t=$(this),e=$(t.data("target"));t.css("opacity",0).css("position","absolute").offset(e.offset()).width(e.outerWidth()).height(e.outerHeight())}),"onwebkitspeechchange"in document.createElement("input")){var n=$("#editor").offset();$("#voiceBtn").css("position","absolute").offset({top:n.top,left:n.left+$("#editor").innerWidth()-35})}else $("#voiceBtn").hide()}function e(t,e){var n="";"unsupported-file-type"===t?n="Unsupported format "+e:console.log("error uploading file",t,e),$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button><strong>File upload error</strong> '+n+" </div>").prependTo("#alerts")}t(),$("#editor").wysiwyg({fileUploadError:e}),window.prettyPrint&&prettyPrint()}}(window.jQuery),function(t,e,n){var o,a=t.getElementsByTagName(e)[0];t.getElementById(n)||(o=t.createElement(e),o.id=n,o.src="http://connect.facebook.net/en_GB/all.js#xfbml=1",a.parentNode.insertBefore(o,a))}(document,"script","facebook-jssdk"),!function(t,e,n){var o,a=t.getElementsByTagName(e)[0];t.getElementById(n)||(o=t.createElement(e),o.id=n,o.src="http://platform.twitter.com/widgets.js",a.parentNode.insertBefore(o,a))}(document,"script","twitter-wjs");