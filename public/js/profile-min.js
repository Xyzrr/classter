var profile=function(){var e={paths:{editAbout:config.ajaxPath+"/profile/edit-about.php",editInfo:config.ajaxPath+"/profile/edit-info.php",editName:config.ajaxPath+"/profile/edit-name.php",getOverview:config.ajaxPath+"/profile/getOverview.php",getSchedule:config.ajaxPath+"/profile/getSchedule.php",getPosts:config.ajaxPath+"/profile/getPosts.php",getReputation:config.ajaxPath+"/profile/getReputation.php"},tabs:{overview:$("a[href='#overview']"),schedule:$("a[href='#schedule-tab']"),posts:$("a[href='#posts']"),reputation:$("a[href='#reputation']")},tabContents:{overview:$("#overview"),schedule:$("#schedule-tab"),posts:$("#posts"),reputation:$("#reputation")},profilePicture:$(".profile-picture"),profilePictureCaption:$("#profile-picture-caption"),profilePictureFile:$("#profile-picture-file"),profilePictureForm:$("#profile-picture-form"),profilePictureImage:$("#profile-picture-image"),targetIDField:$("#target-id")},t=function(){if(e.targetIDField.length){switch($("#name").editable(u),e.targetID=e.targetIDField.val(),$(".nav>li.active>a").attr("href")){case"#overview":a();break;case"#schedule-tab":i();break;case"#posts":o();break;case"#reputation":r()}e.tabs.schedule.on("shown.bs.tab",i),e.tabs.overview.on("shown.bs.tab",a),e.tabs.posts.on("shown.bs.tab",o),e.tabs.reputation.on("shown.bs.tab",r)}e.profilePictureCaption.click(function(){e.profilePictureFile.click()}),e.profilePictureFile.change(c)},a=function(){$.ajax({method:"GET",url:e.paths.getOverview,data:{targetID:e.targetID},success:function(t){e.tabContents.overview.html(t),$("#about").editable(n),$("#info").editable(s);var a=$("#rep-panel"),i=parseInt(a.find("#question-rep").val(),10),o=parseInt(a.find("#answer-rep").val(),10),r=parseInt(a.find("#review-rep").val(),10),u=[{value:i,color:"#F7464A",highlight:"#FF5A5E",label:"Questions"},{value:o,color:"#46BFBD",highlight:"#5AD3D1",label:"Answers"},{value:r,color:"#FDB45C",highlight:"#FFC870",label:"Class Reviews"}],c={animateRotate:!1},l=$("#rep-pie-chart").get(0).getContext("2d"),h=new window.Chart(l).Pie(u,c);h.update()}})},i=function(){$.ajax({method:"GET",url:e.paths.getSchedule,data:{targetID:e.targetID},success:function(t){e.tabContents.schedule.html(t),$("#schedule").schedule()}})},o=function(){$.ajax({method:"GET",url:e.paths.getPosts,data:{targetID:e.targetID},success:function(t){e.tabContents.posts.html(t)}})},r=function(){$.ajax({method:"GET",url:e.paths.getReputation,data:{targetID:e.targetID},success:function(t){e.tabContents.reputation.html(t)}})},n=function(t,a){$.ajax({method:"POST",url:e.paths.editAbout,data:a.serialize(),success:function(e){t.find("#about-read").html(e)}})},s=function(t,a){$.ajax({method:"POST",url:e.paths.editInfo,data:a.serialize(),success:function(e){t.find("#grade-read").html(e)}})},u=function(t,a){$.ajax({method:"POST",url:e.paths.editName,data:a.serialize(),success:function(e){t.find("h1").html(e)}})},c=function(){var t=this.files[0],a=h(t);if(a){var i=document.createElement("img");i.src=window.URL.createObjectURL(t),setTimeout(function(){var t=l(i,40),a=l(i,150),o=l(i,200),r=t.toDataURL("image/jpeg"),n=a.toDataURL("image/jpeg"),s=o.toDataURL("image/jpeg");console.log(s),e.profilePictureImage.attr("src",s),$.ajax({url:config.ajaxPath+"/uploadProfilePicture.php",method:"POST",data:{smallThumbnail:r.substring(1),mediumThumbnail:n.substring(1),largeThumbnail:s.substring(1)},success:function(){},error:function(){e.profilePicture.displayError()},cache:!1})},200)}},l=function(e,t){var a=document.createElement("canvas"),i=a.getContext("2d"),o=t,r=e.width,n=e.height,s=0,u=0,c;return r>n?(c=r/n,n>o?(r=c*o,n=o,s=-(c-1)*o/2,a.width=o,a.height=o):(a.width=n,a.height=n,s=-(c-1)*r/2)):(c=n/r,r>o?(n=c*o,r=o,u=-(c-1)*o/2,a.width=o,a.height=o):(a.width=r,a.height=r,u=-(c-1)*n/2)),i.drawImage(e,s,u,r,n),a},h=function(t){return e.profilePicture.validify({position:"bottom",rules:[{method:function(){return t.type.match(/image.*/)},error:"This file is not an image."},{method:function(){return t.size<10485760},error:"Must be under 10 MB."}]})};return{init:t}}();$(function(){profile.init()});