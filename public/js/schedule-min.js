!function($){"use strict";$.fn.schedule=function(){var e=$(this),a={paths:{getSchedule:config.ajaxPath+"/getSchedule.php",getClassSuggestions:config.ajaxPath+"/getClassSuggestions.php",getCourses:config.ajaxPath+"/getCourses.php",setCourseLevel:config.ajaxPath+"/setCourseLevel.php"},joinClassModal:$("#join-class"),teacherSearchField:$("#teacher-search"),setCourseModal:$("#set-course"),courseSearchField:$("#course-search"),teacherSearchResults:$("#teacher-search-results"),courseSearchResults:$("#course-search-results")},t=function(){$.ajax({method:"GET",url:a.paths.getSchedule,data:{targetID:e.data("id")},success:function(a){e.html(a);var t=$(".footable");t.footable(),s(),t.on("footable_row_expanded",s),t.on("footable_breakpoint",s),$("select").selectpicker(),$("select.course-level-selector").change(l)}})},s=function(){$(".set-period, .change-teacher").click(o),$(".change-course, .set-course").click(c);var e=$(".footable-row-detail .change-room");e.each(function(){var e=$(this),a=$(this).data("period");$(this).data("editable")||$(this).editable(function(){var t=e.find("#room").val();e.find("#room-read").text(t),d(a,t)}).data("editable",!0)})},o=function(){var e=$(this).val();a.joinClassModal.modal("show"),r(e,""),a.teacherSearchField.attr("placeholder","Your period "+e+" teacher's name"),setTimeout(function(){a.teacherSearchField.focus()},500);var t;a.teacherSearchField.keyup(function(){a.teacherSearchResults.fadeOut(100),clearTimeout(t),t=setTimeout(function(){r(e,a.teacherSearchField.val())},100)})},c=function(){var e=$(this).val();a.setCourseModal.modal("show"),u(e,""),a.courseSearchField.attr("placeholder","Your period "+e+" course name"),setTimeout(function(){a.courseSearchField.focus()},500),a.courseSearchField.keyup(function(){u(e,a.courseSearchField.val())})},r=function(e,t){"undefined"!=typeof a.currentClassAjaxRequest&&a.currentClassAjaxRequest.abort(),a.currentClassAjaxRequest=$.ajax({method:"GET",cache:!1,url:a.paths.getClassSuggestions,data:{query:t,period:e},success:function(t){a.teacherSearchResults.html(t),a.teacherSearchResults.fadeIn(100);var s=$(".thumbnail-wrapper");s.click(function(){a.teacherSearchField.val(""),h(e),i(e,$(this).data("teacher"))})}})},u=function(e,t){"undefined"!=typeof a.currentCourseAjaxRequest&&a.currentCourseAjaxRequest.abort(),a.currentCourseAjaxRequest=$.ajax({method:"GET",cache:!1,url:a.paths.getCourses,data:{query:t},success:function(t){a.courseSearchResults.html(t),$(".course-suggestion").click(function(){a.courseSearchField.val(""),n(e,$(this).data("course"))})}})},i=function(e,s){a.joinClassModal.modal("hide"),$.ajax({method:"POST",url:config.ajaxPath+"/joinClass.php",data:{period:e,teacherUserID:s},success:function(){t()}})},h=function(e){$.ajax({method:"POST",url:config.ajaxPath+"/leaveClass.php",data:{period:e}})},n=function(e,s){a.setCourseModal.modal("hide"),$.ajax({method:"POST",url:config.ajaxPath+"/setCourse.php",data:{period:e,courseID:s},success:function(){t()}})},l=function(){var e=$(this).data("period");$.ajax({method:"GET",url:a.paths.setCourseLevel,data:{period:e,courseLevelID:$(this).val()}})},d=function(e,a){$.ajax({method:"POST",url:config.ajaxPath+"/changeRoom.php",data:{period:e,room:a}})};t()}}(window.jQuery);