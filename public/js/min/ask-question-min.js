var askQuestion=function(){var e={paths:{getCourses:config.ajaxPath+"/getCourses.php",postQuestion:config.ajaxPath+"/postQuestion.php"},classSelector:$("#target-selector-class"),subjectSelector:$("#target-selector-course"),setCourseModal:$("#set-course"),courseSearchField:$("#course-search"),courseSearchResults:$("#course-search-results"),targetRadio:$(".target-radio"),postQuestionButton:$("#post-question"),questionEditor:$("#editor"),questionTitle:$("#title")},t=function(){$.initWysiwyg(),$("select").selectpicker(),e.select=$(".bootstrap-select"),e.subjectSelector.click(s),e.postQuestionButton.click(r),e.questionTitle.validify({position:"top"}),e.select.validify({position:"top"}),e.subjectSelector.validify({position:"top"}),e.questionEditor.validify({position:"top"}),e.postQuestionButton.validify({position:"right"}),e.questionTitle.mustFollow([{rule:function(e){return e.length>=15},html:"The title must have at least 15 characters"}]),e.classSelector.mustFollow([{rule:function(e){return parseInt(e,10)},html:"Please select a class."}]),e.subjectSelector.mustFollow([{rule:function(e){return parseInt(e,10)},html:"Please select a subject."}]),e.questionEditor.mustFollow([{rule:function(){return!0}}])},s=function(t){t.preventDefault(),e.setCourseModal.modal("show"),o(),e.courseSearchField.attr("placeholder","Subject of Question"),setTimeout(function(){e.courseSearchField.focus()},500),e.courseSearchField.keyup(function(){o()})},o=function(){$.ajax({method:"GET",cache:!1,url:e.paths.getCourses,data:{query:e.courseSearchField.val()},success:function(t){e.courseSearchResults.html(t),$(".course-suggestion").click(function(){var t=$(this).find(".course-name").text(),s=$(this).data("class");e.setCourseModal.modal("hide"),e.subjectSelector.removeClass("btn-primary").addClass("btn-success").html(t).val(s).trigger("change")})}})},r=function(t){t.preventDefault();var s;s=$("#target-class").parent().hasClass("active")?"class":"course",$.ajax({method:"POST",url:e.paths.postQuestion,data:{target:s,classID:e.classSelector.val(),courseID:e.subjectSelector.val(),title:$("#title").val(),postBody:e.questionEditor.cleanHtml()},success:function(t){var s=$.parseJSON(t);s.success?document.location.href="../?id="+s.postID:(e.questionTitle.checkErrors([s.title],function(e){e.parent().addClass("has-error").addClass("has-feedback")}),e.questionEditor.checkErrors([s.body],function(e){e.parent().addClass("has-error")}),s.classSelector&&(e.select.displayError(s.classSelector),e.select.parent().addClass("has-error")),e.subjectSelector.checkErrors([s.subjectSelector],function(e){e.parent().addClass("has-error")}))},error:function(){e.postQuestionButton.displayError()}})};return{init:t}}();$(function(){askQuestion.init()});