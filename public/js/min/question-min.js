var question=function(){var e={paths:{getAnswers:config.ajaxPath+"/getAnswers.php",postAnswer:config.ajaxPath+"/postAnswer.php",getQuestion:config.ajaxPath+"/getQuestion.php",getAnswerBox:config.ajaxPath+"/getAnswerBox.php",deletePost:config.ajaxPath+"/deletePost.php"},answers:$("#answers"),writeAnswer:$("#write-answer-panel"),question:$("#question"),answerBox:$("#answer-box"),showAnswerBoxButton:$("#show-answer-box"),deleteQuestionModal:$("#delete-question-confirmation"),deleteQuestionConfirm:$("#delete-question-confirm")},t=function(){e.question.length&&(o(),n()),e.showAnswerBoxButton.length?e.showAnswerBoxButton.click(a):a(),e.deleteQuestionConfirm.click(i),e.deleteQuestionConfirm.validify({position:"left"})},o=function(){$.ajax({method:"GET",url:e.paths.getQuestion,data:{postID:e.question.data("id")},success:function(t){e.question.html(t),e.question.find(".rep-box").voteBox(),e.question.find(".comment-box").commentBox(),e.question.find(".delete-post").click(function(){e.deleteQuestionModal.modal("show")})}})},n=function(){$.ajax({method:"GET",url:e.paths.getAnswers,data:{postID:e.question.data("id")},success:function(t){e.answers.html(t),e.answers.find(".rep-box").voteBox(),e.answers.find(".comment-box").commentBox(),e.answers.find(".delete-post").validify({position:"left"}).click(function(){r($(this).parents(".answer-panel"))})}})},s=function(t){t.preventDefault(),$.ajax({method:"POST",url:e.paths.postAnswer,data:{postID:e.question.data("id"),postBody:e.answerEditor.cleanHtml()},success:function(t){var o=$.parseJSON(t);o.success?(n(),e.answerBox.remove()):e.answerEditor.checkErrors([o.error,o.serverError],function(e){e.parent().addClass("has-error")})},error:function(){e.postAnswerButton.displayError()}})},r=function(t){$.ajax({method:"POST",url:e.paths.deletePost,data:{postID:t.data("id")},success:function(e){var o=$.parseJSON(e);o.success?t.hide(200):t.find(".delete-answer").checkErrors([o.error])},error:function(){t.find(".delete-answer").displayError()}})},i=function(){$.ajax({method:"POST",url:e.paths.deletePost,data:{postID:e.question.data("id")},success:function(t){var o=$.parseJSON(t);o.success?document.location.href="?":e.deleteQuestionConfirm.checkErrors([o.error])},error:function(){e.deleteQuestionConfirm.displayError()}})},a=function(){$.ajax({method:"GET",url:e.paths.getAnswerBox,success:function(t){e.answerBox.html(t).hide().fadeIn(300),e.postAnswerButton=$("#post-answer"),e.postAnswerButton.click(s).validify({position:"right"}),$.initWysiwyg(),e.answerEditor=$("#editor"),e.answerEditor.validify({position:"top"})}})};return{init:t}}();$(function(){question.init()});